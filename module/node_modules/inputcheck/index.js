/**
 * Created by PhpStorm.
 * Author:   ershov-ilya
 * GitHub:   https://github.com/ershov-ilya/
 * About me: http://about.me/ershov.ilya (EN)
 * Website:  http://ershov.pw/ (RU)
 * Date: 11.12.2015
 * Time: 16:25
 */

var util = require('util');
var eventEmitter = require('events').EventEmitter; // Извлечение конкретного объекта
var fs = require('fs');

exports.inputChecker = inputChecker; // Экспортируемый объект

function inputChecker(name, file) {
    this.name = name;
    this.writeStream = fs.createWriteStream('./' + file + '.txt',
        {'flags' : 'a',
            'encoding' : 'utf8',
            'mode' : 0666});
}

util.inherits(inputChecker,eventEmitter); // Наследование

inputChecker.prototype.check = function check(input) {
    var self = this;
    var command = input.toString().trim().substr(0,3);
    if (command == 'wr:') {
        self.emit('write',input.substr(3,input.length));
    } else if (command == 'en:') {
        self.emit('end');
    } else {
        self.emit('echo',input);
    }
};
